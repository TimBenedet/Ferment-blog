---
import Layout from '../../layouts/Layout.astro';
import ArticleCard from '../../components/ArticleCard.astro';
import { getCollection } from 'astro:content';

const allArticles = await getCollection('journal');

// Trier par date décroissante
const articles = allArticles
  .sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime())
  .map(article => ({
    title: article.data.title,
    slug: article.slug,
    excerpt: article.data.excerpt,
    category: article.data.category,
    date: article.data.date,
  }));

const categories = ['Tous', 'Koji', 'Miso', 'Bière', 'Zéro Déchet'];
---

<Layout title="Journal" description="Articles et réflexions sur la fermentation, le koji, le miso et le zéro déchet.">
  <!-- Hero -->
  <section class="py-16 lg:py-24 bg-[--color-ferment-darker]">
    <div class="max-w-7xl mx-auto px-6">
      <h1 class="text-4xl md:text-5xl lg:text-6xl font-display font-bold tracking-wider text-[--color-ferment-cream] mb-4">
        JOURNAL
      </h1>
      <p class="text-xl text-[--color-ferment-gray] max-w-2xl">
        Explorations, expériences et réflexions autour de la fermentation.
      </p>
    </div>
  </section>

  <!-- Filters -->
  <section class="py-8 border-b border-white/5">
    <div class="max-w-7xl mx-auto px-6">
      <div class="flex flex-wrap gap-4">
        {categories.map((cat) => (
          <button
            class="px-4 py-2 text-sm font-display uppercase tracking-wider text-[--color-ferment-gray] hover:text-[--color-ferment-accent] border border-white/10 hover:border-[--color-ferment-accent]/50 transition-all data-[active=true]:bg-[--color-ferment-accent] data-[active=true]:text-[--color-ferment-dark] data-[active=true]:border-[--color-ferment-accent]"
            data-category={cat.toLowerCase().replace(' ', '-')}
            data-active={cat === 'Tous' ? 'true' : 'false'}
          >
            {cat}
          </button>
        ))}
      </div>
    </div>
  </section>

  <!-- Articles Grid -->
  <section class="py-16">
    <div class="max-w-7xl mx-auto px-6">
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {articles.map((article) => (
          <ArticleCard article={article} />
        ))}
      </div>
    </div>
  </section>
</Layout>

<script>
  const buttons = document.querySelectorAll('[data-category]');
  const cards = document.querySelectorAll('article');

  buttons.forEach(btn => {
    btn.addEventListener('click', () => {
      // Update active state
      buttons.forEach(b => b.setAttribute('data-active', 'false'));
      btn.setAttribute('data-active', 'true');

      const category = btn.getAttribute('data-category');

      cards.forEach(card => {
        if (category === 'tous') {
          card.style.display = 'block';
        } else {
          const cardCategory = card.querySelector('[class*="uppercase tracking-wider text-"]')?.textContent?.toLowerCase().replace(' ', '-');
          card.style.display = cardCategory === category ? 'block' : 'none';
        }
      });
    });
  });
</script>
